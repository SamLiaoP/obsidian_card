{
  "file_id": "b25d1fb7",
  "name": "8.2a1b Answer Correctness 答案正確性.md",
  "path": "8. 人工智能/8.2 如何優化RAG服務/8.2a1a 優化指標/8.2a1b Answer Correctness 答案正確性.md",
  "content": "#AI服務\n\n## Required:\n- User Input\n- LLM Output\n- Ground True\n\n## 描述\n是評估生成的答案與真實答案（Ground Truth）之間的準確度分數。此分數範圍介於 0 到 1 之間，分數越高表示生成的答案與真實答案的對齊度越高，表示答案的正確性越好。\n\n**答案正確性**涵蓋兩個主要面向：\n\n1. **語意相似度**：測量生成的答案與真實答案在語意上的相似程度。\n2. **事實相似度**：測量事實重疊，考慮生成答案與真實答案中正確的（TP）、錯誤的（FP）、以及缺失的事實（FN）。\n\n可以透過自訂權重來結合這些面向，並根據具體需求調整分數權重。使用者也可以設置 **threshold**（閾值），將分數轉為二進位格式，來判斷答案是否正確（1）或不正確（0）。\n\n## 計算方法\n計算 **答案正確性（Answer Correctness）** 的具體方法可分為兩個步驟：**事實相似度（Factual Similarity）** 和 **語意相似度（Semantic Similarity）**。以下是這兩個分數的具體計算公式，最終的答案正確性則是這兩者的加權平均。\n\n### 1. 事實相似度（Factual Similarity）\n事實相似度利用 **F1 分數** 來衡量生成答案和真實答案的重疊度。計算公式如下：\n\n#### 精確率（Precision）\n$$\n\\text{Precision} = \\frac{|\\text{TP}|}{|\\text{TP}| + |\\text{FP}|}\n$$\n\n#### 召回率（Recall）\n$$\n\\text{Recall} = \\frac{|\\text{TP}|}{|\\text{TP}| + |\\text{FN}|}\n$$\n\n#### F1 分數\n$$\n\\text{Factual Similarity} = \\text{F1 Score} = 2 \\times \\frac{\\text{Precision} \\times \\text{Recall}}{\\text{Precision} + \\text{Recall}}\n$$\n\n其中：\n- TP 是真實答案與生成答案中共同出現的事實數量。\n- FP 是僅在生成答案中出現但不在真實答案中的事實數量。\n- FN 是僅在真實答案中出現但不在生成答案中的事實數量。\n\n### 2. 語意相似度（Semantic Similarity）\n語意相似度可透過語言模型的向量相似度來計算，常用的是 **餘弦相似度（Cosine Similarity）**：\n\n$$\n\\text{Semantic Similarity} = \\frac{\\vec{A} \\cdot \\vec{B}}{\\|\\vec{A}\\| \\|\\vec{B}\\|}\n$$\n\n其中：\n- A 和 B 分別為生成答案和真實答案的向量表示。\n\n### 3. 答案正確性（Answer Correctness）\n將 **事實相似度** 和 **語意相似度** 按權重進行加權平均，最終的答案正確性公式如下：\n\n$$\n\\text{Answer Correctness} = w_1 \\times \\text{Factual Similarity} + w_2 \\times \\text{Semantic Similarity}\n$$\n\n其中：\n- \\( w_1 \\) 和 \\( w_2 \\) 為可調整的權重，且 \\( w_1 + w_2 = 1 \\)。\n- 調整權重可以根據需求強調事實或語意相似度的重要性。\n\n以上公式可幫助您精確計算生成答案的正確性分數，以確保模型生成的答案符合真實答案的預期。\n## 程式碼\n```python\nfrom datasets import Dataset \nfrom ragas.metrics import answer_correctness\nfrom ragas import evaluate\n\n# 準備測試數據\ndata_samples = {\n    'question': ['第一場超級盃何時舉行？', '誰贏得了最多超級盃？'],\n    'answer': ['第一場超級盃於 1967 年 1 月 15 日舉行', '新英格蘭愛國者隊贏得了最多的超級盃'],\n    'ground_truth': ['第一場超級盃於 1967 年 1 月 15 日舉行', '新英格蘭愛國者隊創紀錄地贏了六次超級盃']\n}\n\n# 創建數據集\ndataset = Dataset.from_dict(data_samples)\n\n# 計算答案正確性分數\nscore = evaluate(dataset, metrics=[answer_correctness])\nscore.to_pandas()\n\n```\n\n\n\n## 參考來源：\nhttps://docs.ragas.io/en/v0.1.21/concepts/metrics/answer_correctness.html",
  "size": 2119,
  "lines": 91
}