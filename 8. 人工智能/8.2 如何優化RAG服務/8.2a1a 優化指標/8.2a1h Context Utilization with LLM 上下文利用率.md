
## LLM as a judge  

## Required
- User Input -> Question
- LLM Output -> Answer
- **Retrieved Contexts** -> Contexts

## 描述
**上下文利用率**評估生成的回應是否充分利用檢索到的上下文資訊來完整回答用戶問題。此分數檢查回應是否包含所有必要的上下文資訊，以避免重要細節遺漏而降低回答的完整性和有效性。

### 計算方法
上下文利用率通過以下三種情況進行評估：

1. **完全利用**：生成的回應包含上下文中所有相關資訊。
2. **部分利用**：生成的回應僅包含部分上下文資訊，遺漏了某些回答問題所需的內容。
3. **無利用**：生成的回應完全未使用上下文資訊。

## 程式碼
```python
from uptrain import EvalLLM, Evals

# 插入您的 OpenAI API 密鑰
OPENAI_API_KEY = "sk-********************"

data = [{
    "question": "Where is the Taj Mahal and when was it built?",
    "context": "The Taj Mahal is an ivory-white marble mausoleum located in Agra, Uttar Pradesh, India. It was built in 1631 by the fifth Mughal emperor, Shah Jahan to house the tomb of his beloved wife, Mumtaz Mahal.",
    "response": "The Taj Mahal is located in Agra, Uttar Pradesh, India"
}]

# 初始化上下文利用率評估
eval_llm = EvalLLM(openai_api_key=OPENAI_API_KEY)

# 計算上下文利用率分數
res = eval_llm.evaluate(
    data = data,
    checks = [Evals.RESPONSE_COMPLETENESS_WRT_CONTEXT]
)

print(res)
```

範例輸出：
```json
[
   {
      "score_response_completeness_wrt_context": 0.5,
      "explanation_response_completeness_wrt_context": "Key points present in the context relevant to the given question:\n1. The Taj Mahal is located in Agra, Uttar Pradesh, India.\n2. It was built in 1631 by the fifth Mughal emperor, Shah Jahan.\n\nKey points present in the response relevant to the given question:\n1. The Taj Mahal is located in Agra, Uttar Pradesh, India.\n\nReasoning:\nThe question asks for the location and the construction date of the Taj Mahal. The context provides both pieces of information, stating that it is located in Agra, Uttar Pradesh, India and was built in 1631 by the fifth Mughal emperor, Shah Jahan. The response only includes the location information and does not mention the construction date, which is relevant for answering the question. Therefore, the response does not incorporate all the relevant information present in the context."
   }
]
```

在此範例中，回應僅部分利用上下文資訊，缺少建造年份資訊，因此上下文利用率分數偏低。`Explanation` 提供了詳細說明，指出回應中遺漏的關鍵內容。